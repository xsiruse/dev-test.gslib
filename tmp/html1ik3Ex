<?php

$item = $model->getTable();
$app = JFactory::getApplication();

// getting array of current Fabrik list's main table pk values and imploding them to comma separated list:

$ids = $app->input->get('ids', array(), 'array');
$id = implode(',', $ids);

// connecting to the default database:

$db = FabrikWorker::getDbo();

// getting current list's main db table name

$curtab = $db->quoteName($item->gsl_product);

// Defining needed fields. $db->quoteName ensures that the field names would be surrounded by appropriate quotes ``:

$c_id = $db->quoteName('id');
$c_parent = $db->quoteName('parent_id');
$c_orig = $db->quoteName('orig_text');
$c_sugg = $db->quoteName('suggested');

// Let's query

$query = "SELECT $c_parent, $c_orig, $c_sugg FROM $curtab WHERE $c_id IN($id)";
$db->setQuery($query);

// As this query is set to return multiple rows of data from multiple fields:

$rows = $db->loadObjectList();

/*
    * We got needed data.
    * Now let's connect to the other database where WP blog data resides (Fabrik connection to this db should be set! In this case its id = 2):
*/

$db2 = FabrikWorker::getDbo(false, 2);

// Defining table and needed fields, again using $db->quoteName

$other = $db->quoteName('wp_posts');
$o_id = $db->quoteName('ID');
$o_post = $db->quoteName('post_content');

// Using results of the previous query, generating own UPDATE query for each selected row:

foreach ($rows as $row)
{
    $q = $db2->getQuery(true);

    /*
        * Setting new value for `post_content` field data = replace in `post_content` field data the string $row->orig_text with the string $row->suggested:
        * IMPORTANT: $db2->quote is here the only possible way to ensure that the string values would be surrounded by right quotes in query.
          See i.e thread http://fabrikar.com/forums/index.php?threads/list-php-plugin-query-execution-fails.37517
    */

    $fields = array(
        $o_post . ' = REPLACE(' . $o_post . ', '. $db2->quote($row->orig_text) . ', ' . $db2->quote($row->suggested) . ')'
    );
    $conditions = array(
        $o_id . ' = ' . $row->parent_id
    );

    // Generating the UPDATE query

    $q->update($other)->set($fields)->where($conditions);
    $db2->setQuery($q);

    // processing query/queries

    $db2->execute();
}
?>