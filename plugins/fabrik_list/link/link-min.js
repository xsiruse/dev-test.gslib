/*! Fabrik */

define(["jquery","fab/list-plugin"],function(e,t){return new Class({Extends:t,options:{link:"",fabrikLink:!1,windowTitle:""},initialize:function(t){this.parent(t)},buttonAction:function(){var t=this.list.getForm().getElements("input[name^=ids]").filter(function(t){return t.checked}),i=t.map(function(t){return t.get("value")}),o={};if(t.each(function(t){var i=t.get("value");o[i]=this.list.getRow(i)}.bind(this)),""!==this.options.link){e.each(Fabrik.Windows,function(t,i){t.test(/^custom\./)&&i.close()});var n=this.options.link;if(e.each(o[i[0]],function(t,i){"__pk_val"===t&&(t="rowid");var o=new RegExp("{"+t+"}","g");n=n.replace(o,i)}),this.options.fabrikLink&&this.list.options.ajax_links){n+=n.contains("?")?"&":"?",n+="tmpl=component&ajax=1",n+="&format=partial";var s={id:"custom."+this.list.id,title:this.options.windowTitle,loadMethod:"xhr",contentURL:n,width:this.list.options.popup_width,height:this.list.options.popup_height};null!==this.list.options.popup_offset_x&&(s.offset_x=this.list.options.popup_offset_x),null!==this.list.options.popup_offset_y&&(s.offset_y=this.options.popup_offset_y),Fabrik.getWindow(s)}else window.location=n}}})});