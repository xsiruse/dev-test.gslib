/*! Fabrik */

define(["jquery","fab/fabrik","fab/chosen-loader","fab/element"],function(r,i,t,e){return window.FbTags=new Class({options:{rowid:"",id:0,listid:""},Extends:e,initialize:function(t,e){this.parent(t,e),this.options.editable&&this.setUp()},setUp:function(){i.buildChosen("#"+this.options.element,{disable_search_threshold:10,allow_single_deselect:!0}),this.sel=i.buildAjaxChosen("#"+this.options.element,{type:"GET",url:i.liveSite+"index.php?option=com_fabrik&view=list&listid="+this.options.listid+"&format=tags&elID="+this.options.id,dataType:"json",jsonTermKey:"like",afterTypeDelay:"500",minTermLength:"3"},function(t){var i=[];return r.each(t,function(t,e){i.push({value:e.value,text:e.text})}),i});var e=this.sel;r(e).on("change",function(){var t=r(e).find("option");r(e.data().chosen.results_data).each(function(){r(t[this.options_index]).attr("selected",this.selected)})}),this.watchNew()},watchNew:function(){var a,l="#fabrik#",o=r(this.getContainer()),h=this.options.element;o.find(".search-field input").keydown(function(t){if(3<=this.value.length&&(13===t.which||188===t.which)){var e=o.find("li.active-result.highlighted").first();if(13===t.which&&""!==e.text()){var i=l+e.text();o.find("option").filter(function(){return r(this).val()===i}).remove(),(a=o.find("option").filter(function(){return r(this).html()===e.text()})).attr("selected","selected")}else{var n=this.value;if(""!==(a=o.find("option").filter(function(){return r(this).html()===n})).text())a.attr("selected","selected");else{var s=r("<option>");s.text(this.value).val(l+this.value),s.attr("selected","selected"),o.find("select").append(s)}}this.value="",r("#"+h).trigger("liszt:updated"),t.preventDefault()}})},cloned:function(t){i.fireEvent("fabrik.tags.update",this),this.parent(t),this.setUp()}}),window.FbTags});